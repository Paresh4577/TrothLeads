<div class="px-4 pb-4 max-h-none w-full">
    <div class="pt-4 sticky z-30 headingBorder top-0 w-full">
        <!-- region main heading -->
        <h1 class="new-head h-14 text-lg px-4 py-1.5 rounded flex justify-between items-center font-semibold">
            {{ title }}
            <div class="flex gap-x-3  items-center text-lg font-normal">
                <button mat-raised-button class="new-button" (click)="backClicked()">Cancel</button>
                <button mat-raised-button class="new-button" (click)="resetForm()">Reset</button>
                <!-- <button mat-raised-button class="new-button" (click)="ExpandCollaps()">
                    {{isExpand ? 'Collapse' : 'Expand All'}}
                </button> -->
                <button mat-raised-button class="new-button" (click)="generateReport()">Generate</button>
            </div>
        </h1>
    </div>
    <!-- endregion main heading -->

    <!-- region form -->
    <form [formGroup]="comparativeGrowthReportForm">
        <!-- region body -->
        <div class="py-5 rounded">
            <mat-stepper orientation="vertical" #stepper [linear]="true" [ngClass]="isExpand ? 'showstep' : ''">

                <!-- Insurance Co. & Policy Details -->
                <mat-step label="Insurance Co. & Policy Details" [stepControl]="comparativeGrowthValidations()">

                    <div class="grid lg:grid-cols-3 sm:grid-cols-2 gap-5 mt-4">

                        <!-- Insurance Co. -->
                        <div class="relative ">
                            <div class="icon">
                                <mat-icon>domain</mat-icon>
                            </div>
                            <select class="peer" id="PolicyPeriod" formControlName="InsuranceCompany">
                                <option value="">--Select--</option>
                                <option *ngFor="let option of insuranceCompanyList" [value]="option.Code">
                                    {{option.ShortName}}
                                </option>
                            </select>
                            <label for="Type" class="">Insurance Co.</label>
                        </div>

                        <!-- >Current Period-From Date -->
                        <div class="relative col-start-1">
                            <div class="icon">
                                <mat-datepicker-toggle class="-ml-2" matIconSuffix [for]="FromDate"></mat-datepicker-toggle>
                                <mat-datepicker #FromDate></mat-datepicker>
                            </div>
                            <div class="flex">
                                <input matInput type="text" id="FromDate" placeholder="__/__/____" datemask 
                                   formControlName="CurrentPeriodFromDate" [matDatepicker]="FromDate" class="peer" />
                                <label for="FromDate" class="mandatory">Current Period-From Date</label>
                            </div>
                        </div>
                        
                        <!-- >Current Period-To Date -->
                        <div class="relative" >
                            <div class="icon">
                                <mat-datepicker-toggle class="-ml-2" matIconSuffix [for]="ToDate"></mat-datepicker-toggle>
                                <mat-datepicker #ToDate></mat-datepicker>
                            </div>
                            <div class="flex">
                                <input matInput type="text" id="ToDate" placeholder="__/__/____" datemask 
                                [min]="this.comparativeGrowthReportForm.get('CurrentPeriodFromDate').value"
                               formControlName="CurrentPeriodToDate"  [matDatepicker]="ToDate" class="peer" />
                                <label for="ToDate" class="mandatory">Current Period-To Date</label>
                            </div>
                        </div>
                        
                        <!--Previous Period-From Date -->
                        <div class="relative col-start-1">
                            <div class="icon">
                                <mat-datepicker-toggle class="-ml-2" matIconSuffix [for]="PreviousPeriodFromDate"></mat-datepicker-toggle>
                                <mat-datepicker #PreviousPeriodFromDate></mat-datepicker>
                            </div>
                            <div class="flex">
                                <input matInput type="text" id="PreviousPeriodFromDate" placeholder="__/__/____" datemask 
                               formControlName="PreviousPeriodFromDate"     [matDatepicker]="PreviousPeriodFromDate" class="peer" />
                                <label for="PreviousPeriodFromDate" class="mandatory">Previous Period-From Date</label>
                            </div>
                        </div>
                        
                        <!--Previous Period-To Date -->
                        <div class="relative" >
                            <div class="icon">
                                <mat-datepicker-toggle class="-ml-2" matIconSuffix [for]="PreviousPeriodToDate"></mat-datepicker-toggle>
                                <mat-datepicker #PreviousPeriodToDate></mat-datepicker>
                            </div>
                            <div class="flex">
                                <input matInput type="text" id="PreviousPeriodToDate" placeholder="__/__/____" datemask 
                                 [min]="this.comparativeGrowthReportForm.get('PreviousPeriodFromDate').value"
                                formControlName="PreviousPeriodToDate" [matDatepicker]="PreviousPeriodToDate" class="peer" />
                                <label for="PreviousPeriodToDate" class="mandatory">Previous Period-To Date</label>
                            </div>
                        </div>


                    </div>

                    <div class="mt-3 flex flex-wrap gap-3" *ngIf="!isExpand">
                        <button class="bg-royal text-white" type="button" mat-button matStepperPrevious>
                            Back
                        </button>
                        <button class="bg-royal text-white" type="button" mat-button matStepperNext>
                            Next
                        </button>
                    </div>

                </mat-step>

                <!-- Branch & Team Details -->
                <mat-step label="Branch & Team Details"
                    *ngIf="userProfileObj.UserType == UserTypeEnum.StandardUser">

                    <div class="grid lg:grid-cols-3 ">
                        <div class="grid lg:grid-cols-2 md:col-span-2 sm:grid-cols-2 gap-5 mt-4">

                            <!-- Branch -->
                            <div class="relative ">
                                <div class="icon">
                                    <mat-icon>spa</mat-icon>
                                </div>
                                <select id="Branch" formControlName="BranchId">
                                    <option value="" *ngIf="branches.length > 1">--Select--</option>
                                    <option *ngFor="let Branch of branches" [value]="Branch.Id">
                                        {{Branch.Name}}
                                    </option>
                                </select>
                                <label for="Branch" class="">Branch</label>
                            </div>

                            <!-- Sale Person Type -->
                            <div class="relative">
                                <div class="icon">
                                    <mat-icon>person</mat-icon>
                                </div>
                                <select id="SalesPersonType" formControlName="SalesPersonType">
                                    <option value="">--Select-- </option>
                                    <option value="Direct">Direct </option>
                                    <option value="POSP">POSP </option>
                                    <option value="Team Reference">Team Reference</option>
                                </select>
                                <label for="Type" class="">Sale Person Type</label>
                            </div>

                            <!-- Sales Person Name -->
                            <div class="relative " *ngIf="canDisplaySalesPersonField">
                                <div class="icon">
                                    <mat-icon>person</mat-icon>
                                </div>
                                <div class="flex">
                                    <input type="text" class="peer " placeholder=" " id="SalesPersonName"
                                        [matAutocomplete]="SalesSearch" formControlName="SalesPersonName"
                                        autocomplete="off" />
                                    <mat-autocomplete #SalesSearch="matAutocomplete"
                                        (optionSelected)="AutocompleteSelectedEvent($event,'SalesPersonName')">
                                        <mat-option *ngFor="let Sales of salesPerson$ | async" [value]="Sales">
                                            {{Sales.FullName}}
                                        </mat-option>
                                    </mat-autocomplete>
                                    <button class="-m-5 z-10" type="button"
                                        (click)="openDiolog('User','Select Sales Person','SalesPersonName')">
                                        <mat-icon class="-ml-2">search</mat-icon>
                                    </button>
                                    <button type="button" class="-mx-7 z-10" aria-label="clear" matTooltip="Clear"
                                        *ngIf="comparativeGrowthReportForm.get('SalesPersonName').value"
                                        (click)="autocompleteCleardEvent('SalesPersonName')">
                                        <mat-icon>clear</mat-icon>
                                    </button>
                                    <label for="InsertTransactionNo" class="">Sales Person Name</label>
                                </div>

                            </div>

                            <!-- Team Reference -->
                            <div class="relative" *ngIf="canDisplayTeamReferenceField">
                                <div class="icon">
                                    <mat-icon>person_pin</mat-icon>
                                </div>
                                <div class="flex">
                                    <input type="text" class="peer " formControlName="TeamReferenceName" placeholder=" "
                                        id="TeamReferenceUser" autocomplete="off" [matAutocomplete]="TeamRefSearch" />
                                    <mat-autocomplete #TeamRefSearch="matAutocomplete"
                                        (optionSelected)="AutocompleteSelectedEvent($event,'TeamRef')">
                                        <mat-option *ngFor="let Team of teamRefUser$ | async" [value]="Team">
                                            {{Team.FullName}}
                                        </mat-option>
                                    </mat-autocomplete>
                                    <button class="-m-5 z-10" type="button"
                                        (click)="openDiolog('User','Select Team Reference','TeamRef')">
                                        <mat-icon class="-ml-2">search</mat-icon>
                                    </button>
                                    <button *ngIf="comparativeGrowthReportForm.get('TeamReferenceName').value " type="button"
                                        class="-m-7 z-10" aria-label="clear" matTooltip="Clear"
                                        (click)="autocompleteCleardEvent('TeamRef')">
                                        <mat-icon>clear</mat-icon>
                                    </button>
                                    <label for="InsertTransactionNo" class="">Team Reference</label>
                                </div>

                            </div>

                            <!-- BDO -->
                            <div class="relative " *ngIf="canDisplayBDOField">
                                <div class="icon">
                                    <mat-icon>person</mat-icon>
                                </div>
                                <div class="flex">
                                    <input type="text" class="peer " placeholder=" " id="BDOName"
                                        [readOnly]="!canEditableBdoBdm" [matAutocomplete]="CRESearch"
                                        formControlName="BDOName" />
                                    <mat-autocomplete #CRESearch="matAutocomplete"
                                        (optionSelected)="AutocompleteSelectedEvent($event,'BDOName')">
                                        <mat-option *ngFor="let CRE of bdoList$ | async" [value]="CRE">
                                            {{CRE.FullName}}
                                        </mat-option>
                                    </mat-autocomplete>
                                    <button class="-m-5 z-10" type="button" *ngIf="canEditableBdoBdm"
                                        (click)="openDiolog('User','Select BDO Name','BDOName')"><mat-icon
                                            class="-ml-2">search</mat-icon></button>
                                    <button type="button" class="-mx-7 z-10" aria-label="clear" matTooltip="Clear"
                                        *ngIf="comparativeGrowthReportForm.get('BDOName').value && canEditableBdoBdm"
                                        (click)="autocompleteCleardEvent('BDOName')">
                                        <mat-icon>clear</mat-icon>
                                    </button>
                                    <label for="InsertTransactionNo" class="">BDO</label>
                                </div>

                            </div>

                            <!-- BDM -->
                            <div class="relative" *ngIf="canDisplayBDMField">
                                <div class="icon">
                                    <mat-icon>person</mat-icon>
                                </div>
                                <div class="flex">
                                    <input type="text" class="peer " placeholder=" " formControlName="BDMName"
                                        id="BDMName" [readOnly]="!canEditableBdoBdm" [matAutocomplete]="CRMSearch" />
                                    <mat-autocomplete #CRMSearch="matAutocomplete"
                                        (optionSelected)="AutocompleteSelectedEvent($event,'BDMName')">
                                        <mat-option *ngFor="let crm of bdmList$ | async" [value]="crm">
                                            {{crm.FullName}}
                                        </mat-option>
                                    </mat-autocomplete>
                                    <button class="-m-5 z-10" type="button" *ngIf="canEditableBdoBdm"
                                        (click)="openDiolog('User','Select BDM Name','BDMName')"><mat-icon
                                            class="-ml-2">search</mat-icon></button>
                                    <button type="button" class="-mx-7 z-10" aria-label="clear" matTooltip="Clear"
                                        *ngIf="comparativeGrowthReportForm.get('BDMName').value && canEditableBdoBdm"
                                        (click)="autocompleteCleardEvent('BDMName')">
                                        <mat-icon>clear</mat-icon>
                                    </button>
                                    <label for="InsertTransactionNo" class="">BDM</label>
                                </div>

                            </div>

                            <!-- Vertical Head -->
                            <div class="relative" *ngIf="canDisplayVerticalHeadField">
                                <div class="icon">
                                    <mat-icon>person</mat-icon>
                                </div>
                                <div class="flex">
                                    <input type="text" class="peer " placeholder=" " formControlName="VerticleHeadName"
                                        id="VerticleHeadName" [readOnly]="!canEditableVerticalHead"
                                        [matAutocomplete]="VerticalHeadSearch" />
                                    <mat-autocomplete #VerticalHeadSearch="matAutocomplete"
                                        (optionSelected)="AutocompleteSelectedEvent($event,'VerticleHeadName')">
                                        <mat-option *ngFor="let VerticleHead of verticalHeadList$ | async"
                                            [value]="VerticleHead">
                                            {{VerticleHead.FullName}}
                                        </mat-option>
                                    </mat-autocomplete>
                                    <button class="-m-5 z-10" type="button" *ngIf="canEditableVerticalHead"
                                        (click)="openDiolog('User','Select VerticalHead','VerticleHeadName')"><mat-icon
                                            class="-ml-2">search</mat-icon></button>
                                    <button type="button" class="-mx-7 z-10" aria-label="clear" matTooltip="Clear"
                                        *ngIf="comparativeGrowthReportForm.get('VerticleHeadName').value && canEditableVerticalHead"
                                        (click)="autocompleteCleardEvent('VerticleHeadName')">
                                        <mat-icon>clear</mat-icon>
                                    </button>
                                    <label for="VerticleHeadName" class="">Vertical Head</label>
                                </div>

                            </div>


                        </div>

                        <div></div>
                    </div>


                    <div class="mt-3 flex flex-wrap gap-3" *ngIf="!isExpand">
                        <button class="bg-royal text-white" type="button" mat-button matStepperPrevious>
                            Back
                        </button>
                        <button class="bg-royal text-white" type="button" mat-button matStepperNext>
                            Next
                        </button>
                    </div>

                </mat-step>

                <!-- Category Details -->
                <mat-step label="Category Details">

                    <div class="grid lg:grid-cols-3 sm:grid-cols-2 gap-5 my-4">

                        <!-- Category -->
                        <div class="relative ">
                            <div class="icon">
                                <mat-icon>category</mat-icon>
                            </div>
                            <select class="peer bg-white" formControlName="CategoryCode">
                                <option value="">--Select--</option>
                                <option *ngFor="let cat of categoryList" [value]="cat.Code">
                                    {{ cat.Name }}
                                </option>
                            </select>
                            <label for="Type" class="">Category</label>
                        </div>

                        <!-- Sub-Category -->
                        <div class="relative ">
                            <div class="icon">
                                <mat-icon>compass_calibration</mat-icon>
                            </div>
                            <select class="peer bg-white" formControlName="SubCategoryCode">
                                <option value="">--Select--</option>
                                <option *ngFor="let option of subCategoryList" [value]="option.Code">
                                    {{ option.Name }}
                                </option>
                            </select>
                            <label for="Type" class="">Sub-Category</label>
                        </div>

                        <!-- Category Type -->
                        <div class="relative col-start-1">
                            <div class="icon">
                                <mat-icon> compass_calibration</mat-icon>
                            </div>
                            <select class="peer bg-white" formControlName="CategoryType">
                                <option value="">Select</option>
                                <option [value]="option.title" *ngFor="let option of CategoryTypeList">{{option.title}}
                                </option>
                            </select>
                            <label for="" class="">Category Type</label>

                        </div>

                    </div>

                    <div class="mt-3 flex flex-wrap gap-3" *ngIf="!isExpand">
                        <button class="bg-royal text-white" type="button" mat-button matStepperPrevious>
                            Back
                        </button>
                        <button class="bg-royal text-white" type="button" mat-button matStepperNext>
                            Next
                        </button>
                    </div>

                </mat-step>


            </mat-stepper>
        </div>
        <!-- endregion body -->
    </form>
    <!-- endregion form -->

</div>