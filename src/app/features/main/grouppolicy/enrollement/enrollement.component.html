<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Enroll Employee - Broker Admin | Insurance Platform</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    }

    .dashboard-card {
      transition: all 0.3s;
    }

    .action-btn:hover {
      transform: translateY(-2px) scale(1.03);
    }

    .form-input:focus {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
    }

    .required-field::after {
      content: " *";
      color: #ef4444;
    }
  </style>
</head>

<body>
  <!-- Navigation Bar -->
  <nav style="background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 50%, #1e293b 100%); color: white; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); position: sticky; top: 0; z-index: 10; height: 70px;">
    <div style="max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 24px; height: 100%;">
      <div style="display: flex; align-items: center; gap: 12px;">
        <div style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);">
          <i class="fas fa-shield-alt" style="color: white; font-size: 18px;"></i>
        </div>
        <span style="font-size: 24px; font-weight: 700; letter-spacing: -0.5px;">Admin Dashboard</span>
      </div>
      <div style="display: flex; align-items: center; gap: 16px;">
        <div style="display: flex; align-items: center; gap: 8px; background: rgba(255, 255, 255, 0.1); padding: 8px 16px; border-radius: 8px; backdrop-filter: blur(10px);">
          <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-user" style="color: white; font-size: 14px;"></i>
          </div>
          <span style="font-size: 14px; font-weight: 500;">
            <a routerLink="/grouppolicydashboard" style="text-decoration: none; color: inherit;">Back</a>
          </span>
        </div>
      </div>
    </div>
  </nav>

  <div class="container mx-auto px-4 py-8">
    <!-- Header and Navigation -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8">
      <div>
        <h2 class="text-3xl font-bold text-blue-900 mb-2 flex items-center">
          <i class="fas fa-user-check mr-3"></i>Enroll Employee
        </h2>
        <p class="text-gray-600">Enroll employees and their family members in insurance policies.</p>
      </div>
      <div class="flex space-x-2 mt-4 md:mt-0">
        <button 
          type="button"
          (click)="addNewEmployee()"
          class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-lg font-semibold flex items-center action-btn"
        >
          <i class="fas fa-user-plus mr-2"></i>Add Employee
        </button>
        <button onclick="history.back()" class="bg-gray-600 hover:bg-gray-700 text-white px-5 py-2 rounded-lg font-semibold flex items-center action-btn">
          <i class="fas fa-arrow-left mr-2"></i>Back
        </button>
      </div>
    </div>

    <!-- Important Note Card -->
    <div class="bg-green-50 border-l-4 border-green-400 p-6 mb-8 rounded-lg shadow-sm">
      <div class="flex items-start">
        <div class="flex-shrink-0">
          <i class="fas fa-info-circle text-green-400 text-xl"></i>
        </div>
        <div class="ml-3">
          <h3 class="text-lg font-medium text-green-800 mb-2">
            <i class="fas fa-shield-alt mr-2"></i>Employee Enrollment Information
          </h3>
          <div class="text-green-700">
            <p class="mb-2"><strong>Please note the following enrollment details:</strong></p>
            <ul class="list-disc list-inside space-y-1">
              <li>Select the appropriate <strong>policy</strong> for enrollment</li>
              <li>Choose the <strong>employee</strong> to be enrolled</li>
              <li>Select <strong>family members</strong> to include in the policy (if applicable)</li>
              <li>Ensure all information is correct before submitting</li>
              <li>Enrollment will be effective immediately upon confirmation</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Success/Error Messages -->
    <div *ngIf="successMessage" class="bg-green-50 border-l-4 border-green-400 p-4 mb-6 rounded-lg">
      <div class="flex">
        <div class="flex-shrink-0">
          <i class="fas fa-check-circle text-green-400"></i>
        </div>
        <div class="ml-3">
          <p class="text-sm text-green-700">{{ successMessage }}</p>
        </div>
      </div>
    </div>

    <div *ngIf="errorMessage" class="bg-red-50 border-l-4 border-red-400 p-4 mb-6 rounded-lg">
      <div class="flex">
        <div class="flex-shrink-0">
          <i class="fas fa-exclamation-circle text-red-400"></i>
        </div>
        <div class="ml-3">
          <p class="text-sm text-red-700">{{ errorMessage }}</p>
        </div>
      </div>
    </div>

    <!-- Enroll Employee Form -->
    <div class="bg-white rounded-2xl shadow-lg p-8 dashboard-card">
      <form class="space-y-6" (ngSubmit)="saveEnrollmentEmployee()" #enrollForm="ngForm">
        
        <!-- Policy Selection Section -->
       <!-- Policy Selection Section -->
<div class="border-b border-gray-200 pb-6">
  <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
    <i class="fas fa-file-contract mr-2 text-blue-600"></i>Policy Information
  </h4>
  
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-2 required-field">
      <i class="fas fa-shield-alt mr-1 text-gray-500"></i>Select Policy
    </label>
    <select 
      name="policyId" 
      [(ngModel)]="enrollementdata.policyId" 
      required 
      class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 text-gray-900"
    >
      <option value="" disabled selected hidden>Select Policy</option>
      <option *ngFor="let policy of policies" [value]="policy.PolicyId">
        {{ policy.PolicyName || 'Policy' }} - {{ policy.PolicyType || 'Group Policy' }} 
        <span *ngIf="policy.SumInsured">(Sum Insured: ₹{{ policy.SumInsured }})</span>
      </option>
    </select>
  </div>

  <!-- Policy Details Display -->
  <div *ngIf="enrollementdata.policyId" class="mt-4 p-4 bg-blue-50 rounded-lg">
    <h5 class="font-semibold text-blue-800 mb-2">Selected Policy Details:</h5>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
      <div *ngFor="let policy of policies">
        <div *ngIf="policy.policyid == enrollementdata.policyId">
          <div><strong>Policy Number:</strong> {{ policy.Policyid }}</div>
          <div><strong>Policy Name:</strong> {{ policy.PolicyName }}</div>
          <div><strong>Sum Insured:</strong> ₹{{ policy.SumInsured }}</div>
          <div><strong>Start Date:</strong> {{ policy.PolicyStartDate | date:'mediumDate' }}</div>
          <div><strong>End Date:</strong> {{ policy.PolicyEndDate | date:'mediumDate' }}</div>
          <div><strong>Insurer:</strong> {{ policy.InsurerName }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

        <!-- Employee Selection Section -->
        <div class="border-b border-gray-200 pb-6">
          <h4 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
            <i class="fas fa-user mr-2 text-blue-600"></i>Employee Information
          </h4>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2 required-field">
              <i class="fas fa-user mr-1 text-gray-500"></i>Select Employee
            </label>
            <select 
              name="employeeId" 
              [(ngModel)]="enrollementdata.empId" 
              (ngModelChange)="onEmployeeChange()"
              required 
              class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 text-gray-900"
            >
              <option value="" disabled selected hidden>Select Employee</option>
              <option *ngFor="let employee of employees" [value]="employee.EmpId">
                {{ employee.FirstName }} {{ employee.LastName || '' }} - {{ employee.Email }}
              </option>
            </select>
          </div>

          <!-- Employee Details Display -->
          <div *ngIf="enrollementdata.empId" class="mt-4 p-4 bg-gray-50 rounded-lg">
            <div class="flex justify-between items-start mb-3">
              <h5 class="font-semibold text-gray-800">Selected Employee Details:</h5>
              <div class="flex space-x-2">
                <button 
                  type="button"
                  (click)="viewEmployee()"
                  class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm font-semibold flex items-center"
                >
                  <i class="fas fa-eye mr-1"></i>View
                </button>
                <button 
                  type="button"
                  (click)="editEmployee()"
                  class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-sm font-semibold flex items-center"
                >
                  <i class="fas fa-edit mr-1"></i>Edit
                </button>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm" *ngFor="let emp of employees">
              <div *ngIf="emp.EmpId == enrollementdata.empId">
                <div>
                  <strong>Name:</strong> 
                  <span 
                    class="text-blue-600 hover:text-blue-800 cursor-pointer hover:underline"
                    (click)="viewEmployeeDashboard(emp.EmpId)"
                    title="View Employee Dashboard"
                  >
                    {{ emp.FirstName }} {{ emp.LastName || '' }}
                  </span>
                </div>
                <div><strong>Email:</strong> {{ emp.Email }}</div>
                <div><strong>Mobile:</strong> {{ emp.Mobile || 'N/A' }}</div>
                <div><strong>Employee ID:</strong> EMP{{ emp.EmpId }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Family Members Selection Section -->
        <div class="pb-6">
          <div class="flex justify-between items-center mb-4">
            <h4 class="text-lg font-semibold text-gray-800 flex items-center">
              <i class="fas fa-users mr-2 text-blue-600"></i>Family Members (Optional)
            </h4>
            <div class="flex space-x-2">
              <button 
                type="button"
                (click)="refreshFamilyMembers()"
                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold flex items-center"
              >
                <i class="fas fa-sync-alt mr-2"></i>Refresh
              </button>
              <button 
                type="button"
                (click)="addFamilyMember()"
                class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold flex items-center"
              >
                <i class="fas fa-plus mr-2"></i>Add Family Member
              </button>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fas fa-users mr-1 text-gray-500"></i>Select Family Member to Include
            </label>
            
            <div *ngIf="family">
              <select 
                name="familyMemberId" 
                [(ngModel)]="enrollementdata.familyId" 
                class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300 text-gray-900"
              >
                <option value="" disabled selected hidden>Select Family Member (Optional)</option>
                <option *ngFor="let member of family" [value]="member.UserFamilyMemberId">
                  {{ member.FamilyName }} - {{ member.Relation }}
                  <span *ngIf="member.DOB"> (DOB: {{ member.DOB | date:'shortDate' }})</span>
                </option>
              </select>

              <!-- Selected Family Member Details -->
              <div *ngIf="enrollementdata.familyId" class="mt-4 p-4 bg-green-50 rounded-lg">
                <h5 class="font-semibold text-green-800 mb-2">Selected Family Member:</h5>
                <div *ngFor="let member of family">
                  <div *ngIf="member.UserFamilyMemberId == enrollementdata.familyId" class="text-sm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div><strong>Name:</strong> {{ member.FamilyName }}</div>
                      <div><strong>Relationship:</strong> {{ member.Relation }}</div>
                      <div><strong>Date of Birth:</strong> {{ member.DOB ? (member.DOB | date:'mediumDate') : 'N/A' }}</div>
                      <div><strong>Gender:</strong> {{ member.Gender || 'N/A' }}</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div *ngIf="!family || family.length === 0" class="text-gray-500 text-center py-4 border-2 border-dashed border-gray-300 rounded-lg">
              <i class="fas fa-users text-2xl mb-2"></i>
              <p>No family members available for enrollment</p>
              <div class="mt-4">
                <button 
                  type="button"
                  (click)="addFamilyMember()"
                  class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold flex items-center mx-auto"
                >
                  <i class="fas fa-plus mr-2"></i>Add Family Member
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Enrollment Summary -->
        <div *ngIf="enrollementdata.policyId && enrollementdata.empId" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
          <h4 class="text-lg font-semibold text-yellow-800 mb-3 flex items-center">
            <i class="fas fa-calculator mr-2"></i>Enrollment Summary
          </h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div><strong>Policy ID:</strong> {{ enrollementdata.policyId }}</div>
            <div><strong>Employee ID:</strong> {{ enrollementdata.empId }}</div>
            <div><strong>Family Member ID:</strong> {{ enrollementdata.familyId || 'None Selected' }}</div>
            <div><strong>Status:</strong> Ready for Enrollment</div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="flex flex-col md:flex-row justify-end gap-4 pt-6 border-t border-gray-200">
          <button 
            type="button" 
            class="action-btn bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center transition-all duration-300"
            onclick="history.back()"
          >
            <i class="fas fa-times mr-2"></i>Cancel
          </button>
         <button 
  type="button" 
  class="action-btn bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center transition-all duration-300"
  (click)="resetForm()"
>
  <i class="fas fa-undo mr-2"></i>Reset Form
</button>
    <button 
  type="submit"
  [disabled]="!enrollForm.form.valid || !enrollementdata.policyId || !enrollementdata.empId"
  class="action-btn bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-3 rounded-lg font-semibold flex items-center justify-center transition-all duration-300"
>
  <i class="fas fa-save mr-2"></i>Enroll Employee
</button>