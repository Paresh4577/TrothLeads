<div class="px-4 pb-4 max-h-none w-full">
    <!-- region Main Heading -->
    <div class=" top-0 z-40 bg-default pt-4">
        <h1 class="new-head text-lg px-4 py-1.5 mb-4 rounded flex justify-between items-center font-semibold">
            {{ title }}

            <div class="flex gap-x-3 items-center text-lg font-normal">
                <button mat-raised-button [disabled]="backDisable" class="new-button" (click)="back()">
                    Back
                </button>
                <button #menuTriggerCar="matMenuTrigger" (click)="menuTriggerCar.openMenu()" [matMenuTriggerFor]="menuCar">
                    <mat-icon matTooltip="Add-on info" class="text-white">info</mat-icon>
                </button>

            </div>

                <mat-menu #menuCar="matMenu" yPosition="above" overlapTrigger="false" class="px-4 py-3 gap-2 container mx-auto">
                
                    <div class="flex gap-3">
                        <div>
                
                            <div class="flex gap-5 items-center border-b border-sky-500">
                                <i class="fa-solid fa-circle text-green-500"></i>
                                <p>Selected</p>
                            </div>
                
                            <div class="flex gap-5 items-center border-b border-sky-500">
                                <i class="fa-solid fa-circle text-gray-400"></i>
                                <p>Not in plan</p>
                            </div>
                
                            <div class="flex gap-5 items-center border-b border-sky-500">
                                <i class="fa-solid fa-circle text-[#2896fd]"></i>
                                <p>In plan but not selected</p>
                            </div>
                
                        </div>
                    </div>
                
                </mat-menu>
        </h1>

 
                <div class="">
                    <div class="px-4 py-7 rounded bg-white">
                        <mat-card class="bg-sky-100 px-4 py-3 gap-2 container mx-auto">
                
                            <div class="grid sm:grid-cols-[minmax(110px,120px)_1fr] gap-5">
                
                                <div class="self-center">
                                    <div class="max-w-full w-20  mx-auto">
                                        <img class="h-auto w-auto " src="../../../../../../assets/icons/motor.png" alt="car">
                                    </div>
                                </div>
                                <div>
                
                                <div
                                    class="grid lg:grid-cols-[minmax(100px,45%)_minmax(100px,20%)_minmax(100px,20%)_minmax(100px,10%)] md:grid-cols-4 sm:grid-cols-2 sm:text-center items-center grid-cols-1 gap-4">
                
                                    <div class="h-fit gap-3 text-slate-950 sm:grid-cols-1 grid grid-cols-2">
                                        <small>Your car</small>
                                        <span class="font-bold">
                                            {{VehicleDetails.Brand}} {{VehicleDetails.Model}}, {{VehicleDetails.SubModel}} <span
                                                *ngIf="VehicleDetails.CC">({{VehicleDetails.CC}})</span>, {{VehicleDetails.Fuel}},
                                            {{VehicleDetails.VehicleNo}}
                                        </span>
                                    </div>
                
                                    <!-- Month & Year of Mfg -->
                                    <div class="h-fit gap-3 flex-wrap sm:grid-cols-1 grid grid-cols-2">
                                        <small>Month & Year of Mfg</small>
                                        <span class="font-bold"> {{VehicleDetails.ManufacturingDate}} </span>
                                    </div>
                
                                    <!-- Registration Date -->
                                    <div class="h-fit gap-3 flex-wrap sm:grid-cols-1 grid grid-cols-2">
                                        <small>Registration Date</small>
                                        <span class="font-bold"> {{VehicleDetails.RegistrationDate | date: 'dd/MM/yyyy'}}
                                        </span>
                                    </div>
                

                
                                    <div class="-mt-1 h-fit flex-wrap sm:grid-cols-1 grid grid-cols-2">
                                        <button class="w-fit bg-royal text-white text-on-primary-80"
                                            (click)="openPopUpForAddOn('Add-On', 'AddOn')" mat-raised-button>
                                            <mat-icon>list_alt</mat-icon>
                                            <span class="">Add-On</span>
                                        </button>
                                        <!-- <div class="text-start">
                                            <ol class="list-disc list-inside">
                                                <li class="text-green-500"><span class="text-sm text-black">Selected</span></li>
                                                <li class="text-gray-400"><span class="text-sm text-black">Not in plan</span></li>
                                                <li class="text-[#2896fd]"><span class="text-sm text-black">In plan but not
                                                        selected</span></li>
                                            </ol>
                                        </div> -->
                
                                    </div>
                
                                </div>

                                <div class="mt-que mt-2"></div>
                                
                                <div class=" sm:text-center gap-3 mt-1 items-center grid  sm:grid-cols-2
                                lg:grid-cols-[minmax(100px,35%)_minmax(100px,25%)_minmax(100px,25%)_minmax(100px,10%)]">
                                    <!-- IDVStatus  -->
                                    <div class="grid gap-y-2 justify-center">
                                        <div class="relative w-fit flex gap-3 items-center">
                                            <span for="IDVStatus" class="font-medium mt-2">Set Your Own IDV</span>
                                            <mat-slide-toggle color="primary" class="relative mt-1" id="IDVStatus" (change)="onChange($event,'IDVStatus')">
                                            </mat-slide-toggle>
                                        </div>
                                    </div>

                                            <div class="relative grid gap-y-2 items-center">
                                                <span for="slider" class="relative top-2 ">
                                                    <mat-slider [min]="SliderMinValue" [max]="SliderMaxValue" step="0" value="1" [disabled]="isIDVStatus == 0">
                                                        <input matSliderThumb #itemHeight [formControl]="VehicleIDV" [value]="VehicleIDV.value">
                                                    </mat-slider>
                                                </span>

                                                 <div class="flex justify-end relative -top-2">
                                                     <span *ngIf="Policies.length>0" class="text-start "><small>Between {{MinIDVAmount |
                                                             indCurrency}} and {{MaxIDVAmount | indCurrency}}.</small></span>
                                                 </div>
                                            </div>

                                            <div class="relative">
                                                <div class="icon rs">â‚¹</div>
                                                <input type="text" id="idv" maxlength="10" onfocus="this.select()" [value]="itemHeight.value"
                                                    [formControl]="VehicleIDV" class="peer" Onlynumber placeholder=" " [readOnly]="isIDVStatus == 0">
                                            </div>


                                            <div>
                                                <button (click)="getMotorPlans('Go')" class="bg-royal text-white text-on-primary-80" [disabled]="isIDVStatus == 0"
                                                    mat-raised-button>
                                                    <mat-icon>navigate_next</mat-icon>
                                                    Go
                                                </button>
                                            </div>

                                </div>
</div>
                
                            </div>
                
                        </mat-card>
                    </div>
                </div>
    </div>


    <div class="py-5 min-w-full rounded">

        <div class="gap-5">
            <div class="py-2 rounded" *ngFor="let policy of Policies; let i = index">
                <mat-card class="px-4 py-2 shadow-md shadow-blue-200
                 hover:-translate-y-2 hover:bg-blue-100 hover:scale-100 duration-300 ">

                    <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-y-1 sm:text-center">


                        <!-- Insurance Campany Icon  -->
                        <div class="flex justify-start items-center">
                            <div class="flex justify-center" [ngClass]="{
                                            'w-20 h-20':  policy.Insurer?.toLowerCase() == InsuranceCompany.HdfcErgo || policy.Insurer?.toLowerCase() == InsuranceCompany.TataAIA,
                                            'w-48 h-16':  policy.Insurer?.toLowerCase() == InsuranceCompany.Zuno,
                                            'w-28 h-14':  policy.Insurer?.toLowerCase() == InsuranceCompany.GoDigit,
                                        }">
                                <img class="w-auto h-auto" src="{{ policy.IconURL }}" alt="logo" />
                            </div>
                        </div>
                        <!-- <div class="sm:w-48 sm:h-26 p-6 flex justify-center items-center">
                            <img class="w-auto max-w-36 h-auto max-h-20" src="{{ policy.IconURL }}" alt="">
                        </div> -->

                        <hr class="sm:hidden block m-0">
                        <!-- Policy Period -->
                        <div class="sm:block grid grid-cols-2 gap-3">
                            <p>Policy Type :</p> <strong>{{policy.PolicyTypeName}}</strong>
                        </div>

                        <!-- Cover Value(IDV) -->
                        <div class="sm:block grid grid-cols-2 gap-3">
                            <p>Cover Value(IDV) :</p><strong>{{policy.CalIDVAmount | indCurrency}}</strong>
                        </div>

                        <!-- Premium -->
                        <div class="sm:block grid grid-cols-2 gap-3">
                            <p>Premium :</p><strong>{{policy.TotalPremium | indCurrency}}</strong>
                        </div>

                        <!-- POPUp details -->
                        <div class="sm:block grid grid-cols-2 sm:grid-flow-row">
                            <!-- veiw car details -->
                            <div class="">
                                <small class="hover:cursor-pointer text-sky-600" #menuTriggerCar="matMenuTrigger"
                                    (click)="menuTriggerCar.openMenu()" [matMenuTriggerFor]="menuCar">View Car
                                    Details</small>
                            </div>

                            <!-- View Premium Details -->
                            <div class="">
                                <small class="hover:cursor-pointer text-sky-600" #menuTrigger="matMenuTrigger"
                                    (click)="menuTrigger.openMenu()" [matMenuTriggerFor]="menu">View Premium
                                    Details</small>
                            </div>
                        </div>

                        <!-- Buttons -->
                        <div class="sm:block grid lg:grid-rows-2 md:grid-rows-1 sm:grid-rows-2 grid-cols-2 gap-2">
                            <div>
                                <button (click)="buyNow(policy)" mat-raised-button class="bg-royal text-on-primary-800 lg:w-48 md:w-fit sm:w-fit">
                                    <mat-icon>shopping_cart</mat-icon><span class="hidden sm:block">Buy Now </span>
                                </button>
                            </div>
                            <div class="flex items-center sm:justify-center gap-5">
                                <!-- Check Box For Compare Plan -->
                                <div class="flex justify-end">
                                    <input type="checkbox" #ckeck class="w-5 h-5"[disabled]="CompareList.length >=3 && !ckeck.checked" matTooltip="Compare"(change)="AddOrRemoveInCompareList($event, policy,i)" [checked]="policy.isChecked == true" >
                                </div>

                                <!-- <mat-checkbox matTooltip="Compare" [disabled]="CompareList.length >=3 && !ckeck.checked" [checked]="policy.isChecked == true" (change)="AddOrRemoveInCompareList($event, policy,i)"></mat-checkbox> -->
                                <button mat-icon-button disabled type="button" matTooltip="share">
                                    <mat-icon>share</mat-icon>
                                </button>
                                <button mat-icon-button type="button" matTooltip="View Details" (click)="ViewDetails(policy)">
                                    <mat-icon>visibility</mat-icon>
                                </button>
                            </div>
                        </div>

                        <div class="sm:col-span-2 md:col-span-3 lg:col-span-6">
                            <div class="flex flex-wrap gap-0.5">
                                <div *ngFor="let item of policy.CalcPremium?.addonCovers">
                                    <div *ngFor="let element of SelectedAddOns">
                                        <div *ngIf="item.Key==element.Key" class="w-fit py-0.5 flex border text-white text-on-primary-80 px-2 rounded-2xl bg-green-500"
                                        matTooltip="Selected">
                                            <span class="text-sm">{{item.DisplayName}} <span *ngIf="item.Name == 'Electrical_Accessories_Premium' || item.Name == 'NonElectrical_Accessories_Premium' ">{{"("}} {{item.SumInsure | indCurrency}} {{")"}}</span></span>
                                        </div>
                                    </div>
                                </div>
                                <div *ngFor="let element of policy.notInPlan">
                                    <div class="w-fit py-0.5 border px-2 rounded-2xl flex text-white text-on-primary-80 bg-gray-400"
                                    matTooltip="Not in plan">
                                        <span class="text-sm">{{element.DisplayName}}</span>
                                    </div>
                                </div>

                                <div *ngFor="let element of policy.onlyInPlan">
                                    <div class="w-fit py-0.5 border px-2 rounded-2xl flex text-white text-on-primary-80 bg-[#2896fd]"
                                    matTooltip="In plan but not selected">
                                        <span class="text-sm">{{element.DisplayName}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>

                </mat-card>


                <!-- View Premium Details Pop-up -->

                <mat-menu #menu="matMenu" yPosition="above" overlapTrigger="false" class="px-4 py-3 gap-2 container mx-auto">
                    <div>
                        <span class="font-bold text-base">Basic Cover</span>
                    </div>
                    <div *ngFor="let item of policy.CalcPremium?.BasePremium">
                        <div class="flex justify-between space-x-3">
                            <span>{{item.DisplayName}}</span>
                            <span class="font-bold text-base text-right">
                                {{item.Premium | indCurrency}}
                            </span>
                        </div>

                    </div>

                    <div>
                        <span class="font-bold text-base">AddOn Cover</span>
                    </div>
                    <div *ngFor="let item of policy.CalcPremium?.addonCovers">
                        <div class="flex justify-between space-x-3">
                            <span>{{item.DisplayName}}</span>
                            <span class="font-bold text-base text-right">
                                {{item.Premium | indCurrency}}
                            </span>
                        </div>

                    </div>

                    <div>
                        <span class="font-bold text-base">Discount</span>
                    </div>
                    <div *ngFor="let item of policy.CalcPremium?.discounts">
                        <div class="flex justify-between space-x-3">
                            <span>{{item.DisplayName}}</span>
                            <span class="font-bold text-base text-right">
                                -{{item.Premium | indCurrency}}
                            </span>
                        </div>

                    </div>

                    <div *ngFor="let item of policy.CalcPremium?.specialDiscounts">
                        <div class="flex justify-between space-x-3">
                            <span>{{item.DisplayName}}</span>
                            <span class="font-bold text-base text-right">
                                -{{item.Premium | indCurrency}}
                            </span>
                        </div>

                    </div>

                    <mat-divider class="border-t-sky-600"></mat-divider>
                    <!-- Premium -->
                    <div class="flex justify-between space-x-3">
                        <span>Premium</span>
                        <span class="font-bold text-base text-right">
                            {{policy.NetPremium | indCurrency}}
                        </span>
                    </div>

                    <!-- Tax -->
                    <div class="flex justify-between space-x-3">
                        <span>Tax</span>
                        <span class="font-bold text-base text-right">
                            + {{policy.ServiceTax | indCurrency}}
                        </span>
                    </div>

                    <!-- Discount -->
                    <!-- <div class="grid grid-cols-2">
                                <span>Discount</span>
                                <span class="font-bold text-base text-right">
                                   - {{policy.TotalPremium | indCurrency}}
                                </span>
                            </div> -->

                    <mat-divider class="border-t-sky-600"></mat-divider>

                    <!-- Total Premium -->
                    <div class="flex justify-between space-x-3">
                        <span>Total Premium</span>
                        <span class="font-bold text-base text-right">
                            {{policy.TotalPremium | indCurrency}}
                        </span>
                    </div>
                </mat-menu>

                <mat-menu #menuCar="matMenu" yPosition="above" overlapTrigger="false" class="px-4 py-3 gap-2 container mx-auto">

                    <div class="flex space-x-3">
                        <span>Brand :</span>
                        <span class="font-bold text-base">
                            {{policy.BrandName}}
                        </span>
                    </div>

                    <div class="flex space-x-3">
                        <span>Model :</span>
                        <span class="font-bold text-base">
                            {{policy.ModelName}}
                        </span>
                    </div>

                    <div class="flex space-x-3">
                        <span class="shrink-0">Sub-Model:</span>
                        <span class="font-bold text-base">
                            {{policy.SubModelName}}
                        </span>
                    </div>

                </mat-menu>

            </div>
        </div>
    </div>
</div>


<div class="fixed bottom-0 content-center z-40 w-full border-t-4 border-sky-300" *ngIf="CompareList?.length > 0">
    <div>
        <mat-card class="px-4 py-2 shadow-md shadow-blue-200">
            <div class="grid lg:grid-cols-2 md:grid-cols-2 sm:grid-cols-2 grid-cols-2 gap-2">
                <div class="grid lg:grid-cols-3 md:grid-cols-3 sm:grid-cols-3 grid-cols-3 gap-3">
                    <div *ngFor="let plan of CompareList">
                        <div class="sm:block grid grid-cols-3">
                            <img class="max-w-20 h-10 pt-1" src="{{ plan.IconURL }}" alt="logo" />
                        </div>
                        <div class="sm:block">
                            <mat-card-subtitle>{{
                                plan.TotalPremium | indCurrency
                                }}</mat-card-subtitle>
                        </div>
                    </div>
                </div>

                <div class="items-center">
                    <div class="flex justify-between">
                        <button disabled mat-raised-button class="bg-gray-200 text-black lg:w-48 md:w-fit sm:w-fi">
                            <mat-icon>share</mat-icon><span class="hidden sm:block"> Share </span>
                        </button>
                        <button mat-raised-button class="bg-royal text-on-primary-800 lg:w-48 md:w-fit sm:w-fit" (click)="CompareNow()">
                            <mat-icon>compare</mat-icon><span class="hidden sm:block"> Compare now </span>
                        </button>
                        <button mat-raised-button class="bg-gray-200 text-black lg:w-48 md:w-fit sm:w-fi" (click)="CompareClear()">
                            <mat-icon>clear</mat-icon><span class="hidden sm:block"> Clear </span>
                        </button>
                        <br />
                        <small>max 3 plans can be compared at a time</small>
                    </div>
                </div>
            </div>
        </mat-card>
    </div>
</div>
